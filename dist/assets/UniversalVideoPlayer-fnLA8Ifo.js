import{r,u as T,z as B,j as t,h as M}from"./index-CZSZZV6j.js";import{W as P}from"./watchHistory-BPNt32Ju.js";const I=({source:o,onClose:y,isOpen:l,mediaItem:m,mediaType:b,season:h,episode:x})=>{if(!o||!l)return null;const[E,p]=r.useState(!0),i=r.useRef(void 0),a=r.useRef(null),{deviceInfo:s,isMobile:j}=T(),d=s.os==="ios"&&j,g=()=>{p(!0),i.current&&clearTimeout(i.current),i.current=window.setTimeout(()=>{p(!1)},3e3)};r.useEffect(()=>{if(!l||o.type!=="embed")return;console.log(`🎬 Loading ${o.provider} with universal ad/popup blocking`);const n=window.open,u=document.write,w=document.writeln;window.open=function(e,f){return console.log("🚫 Blocked popup attempt to:",e,"target:",f),null};try{Object.defineProperty(window.location,"assign",{value:function(e){console.log("🚫 Blocked location.assign redirect to:",e)},writable:!1})}catch{console.log("⚠️ Could not override location.assign (read-only property)")}try{Object.defineProperty(window.location,"replace",{value:function(e){console.log("🚫 Blocked location.replace redirect to:",e)},writable:!1})}catch{console.log("⚠️ Could not override location.replace (read-only property)")}document.write=function(e){if(e.includes("ad")||e.includes("popup")||e.includes("redirect")||e.includes("banner")||e.includes("sponsor")){console.log("🚫 Blocked document.write with ad content");return}return u.call(document,e)},document.writeln=function(e){if(e.includes("ad")||e.includes("popup")||e.includes("redirect")){console.log("🚫 Blocked document.writeln with ad content");return}return w.call(document,e)};const v=e=>(e.preventDefault(),e.returnValue="",console.log("🚫 Blocked navigation attempt"),""),N=setInterval(()=>{['[id*="ad"]','[class*="ad"]','[id*="popup"]','[class*="popup"]','[id*="banner"]','[class*="banner"]','[id*="sponsor"]','[class*="sponsor"]',".advertisement",".popup",".banner",".sponsor",".ad-container",'iframe[src*="ads"]','iframe[src*="popup"]','iframe[src*="banner"]'].forEach(f=>{document.querySelectorAll(f).forEach(c=>{c instanceof HTMLElement&&c!==a.current&&(c.style.display="none !important",c.style.visibility="hidden !important",c.style.opacity="0 !important")})})},500);return window.addEventListener("beforeunload",v),()=>{window.removeEventListener("beforeunload",v),clearInterval(N),window.open=n,document.write=u,document.writeln=w,console.log("🔄 Restored original window functions (location methods are read-only)")}},[l,o.type,o.provider]),r.useEffect(()=>{if(l){const n=setTimeout(()=>{p(!1)},3e3);return()=>clearTimeout(n)}},[l]),r.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]);const k=()=>o.provider==="VidKing"?`${o.url}${o.url.includes("?")?"&":"?"}color=e50914&autoplay=1&muted=1&playsinline=1`:`${o.url}${o.url.includes("?")?"&":"?"}autoplay=1&muted=1&playsinline=1`;return B.createPortal(t.jsx("div",{className:"fixed inset-0 z-[9999] bg-black",children:t.jsx("div",{className:"relative w-full h-full flex flex-col",onMouseMove:g,onTouchStart:g,children:t.jsxs("div",{className:"flex-1 relative",style:{backgroundColor:"#000",overflow:"hidden"},children:[t.jsx("iframe",{ref:a,src:k(),className:"w-full h-full border-0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",sandbox:"allow-scripts allow-same-origin allow-forms allow-presentation",referrerPolicy:"no-referrer",loading:"eager",title:`${o.provider} Player`,webkitallowfullscreen:"true",mozallowfullscreen:"true",autoPlay:d?"true":void 0,playsInline:d?"true":void 0,style:{border:"none",outline:"none",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1,position:"relative"},onLoad:()=>{if(console.log(`🎬 ${o.provider} player loaded with universal blocking`),console.log("📱 Device:",{isIPhone:d,deviceInfo:s}),m&&P.updateWatchHistory(m,60,7200,b||"movie",h,x),d&&a.current){console.log("📱 iPhone detected - attempting autoplay");try{const n=new URL(o.url).origin;a.current.contentWindow?.postMessage({command:"play",action:"play",type:"play"},n),setTimeout(()=>{const u=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.current?.dispatchEvent(u)},500)}catch(n){console.log("Could not trigger autoplay:",n)}}}}),t.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${E?"opacity-100":"opacity-0"}`,style:{pointerEvents:"none",zIndex:10},children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 h-20 bg-gradient-to-b from-black/50 to-transparent"}),t.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between",style:{paddingTop:s.os==="ios"?"calc(1rem + env(safe-area-inset-top))":"1rem",paddingLeft:s.os==="ios"?"calc(1rem + env(safe-area-inset-left))":"1rem",paddingRight:s.os==="ios"?"calc(1rem + env(safe-area-inset-right))":"1rem"},children:[t.jsxs("button",{onClick:y,className:"flex items-center space-x-2 px-4 py-2 bg-black/70 hover:bg-black/90 rounded-lg transition-colors backdrop-blur-sm z-50 touch:active:scale-95",style:{pointerEvents:"auto"},children:[t.jsx(M,{className:"w-5 h-5"}),t.jsx("span",{className:"text-sm",children:"Back"})]}),t.jsx("div",{className:"flex items-center space-x-2",style:{pointerEvents:"none"},children:t.jsxs("span",{className:"text-sm bg-black/50 px-2 py-1 rounded backdrop-blur-sm",children:[o.provider," • ",o.quality," • Ad-blocked"]})})]})]})]})})}),document.body)};export{I as default};
