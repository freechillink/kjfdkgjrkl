const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/streamingService-jLzF5W_z.js","assets/index-CZSZZV6j.js","assets/index-BP79qFqv.css"])))=>i.map(i=>d[i]);
import{r as l,j as t,B as ce,C as de,F as ue,D as ge,s as pe,E as fe,_ as me}from"./index-CZSZZV6j.js";import{W as P}from"./watchHistory-BPNt32Ju.js";const be=({source:x,title:R,onClose:G,isOpen:h,mediaItem:d,mediaType:c,season:y,episode:j,onNextEpisode:S})=>{if(!x)return null;const[v,F]=l.useState(0),[A,J]=l.useState([x]),[D,N]=l.useState(!1),[W,K]=l.useState(0),[b,M]=l.useState(!1),[$,z]=l.useState(!1),[Q,Y]=l.useState(1),[_,E]=l.useState(0),[L,Z]=l.useState(0),[O,H]=l.useState(!0),s=l.useRef(null),U=l.useRef(void 0),g=l.useRef(void 0),V=l.useRef(null),C=l.useRef(null),ee=n=>{const i=new URL(n),r=i.pathname.split("/"),w=new URLSearchParams(i.search),m=w.get("tmdb")||r[r.length-1],k=n.includes("/tv"),p=w.get("s"),f=w.get("e");return[n,k&&p&&f?`https://vidlink.pro/embed/tv/${m}/${p}/${f}`:`https://vidlink.pro/embed/movie/${m}`,k&&p&&f?`https://vidlink.pro/embed/tv?tmdb=${m}&s=${p}&e=${f}`:`https://vidlink.pro/embed/movie?tmdb=${m}`,k&&p&&f?`https://vidlink.pro/watch/tv/${m}/${p}/${f}`:`https://vidlink.pro/watch/movie/${m}`,k&&p&&f?`https://vidlink.pro/player/tv/${m}/${p}/${f}`:`https://vidlink.pro/player/movie/${m}`].filter((a,e,X)=>X.indexOf(a)===e)};l.useEffect(()=>{if(!h)return;console.log("ðŸš« VidLink.pro Player - Initializing minimal popup blocking");const n=/iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent);n&&console.log("ðŸ“± VidLink.pro - Mobile device detected, using minimal blocking for compatibility");const i=window.open,r=window.alert,w=window.confirm,m=window.prompt,k=document.write;window.open=function(...o){return console.log("ðŸš« VidLink.pro - Blocked popup attempt:",o[0]),null},window.alert=function(o){console.log("ðŸš« VidLink.pro - Blocked alert:",o)},window.confirm=function(o){return console.log("ðŸš« VidLink.pro - Blocked confirm:",o),!1},window.prompt=function(o){return console.log("ðŸš« VidLink.pro - Blocked prompt:",o),null},document.write=function(o){if(o&&(o.includes("ad")||o.includes("popup")||o.includes("redirect")||o.includes("aclib")||o.includes("histats")||o.includes("acscdn")||o.includes("vidlink")||o.includes("analytics"))){console.log("ðŸš« VidLink.pro - Blocked document.write with ad content");return}return k.call(document,o)};try{const o=window.location.assign,a=window.location.replace;window.location.assign=function(e){return e.includes("ads")||e.includes("popup")||e.includes("redirect")||e.includes("promo")||e.includes("offer")||e.includes("casino")||e.includes("betting")||e.includes("dating")||e.includes("adult")||e.includes("doubleclick")||e.includes("googlesyndication")||e.includes("facebook.com/tr")||e.includes("googletagmanager")?(console.log("ðŸš« VidLink.pro - Blocked ad redirect:",e),!1):(console.log("âœ… VidLink.pro - Allowing legitimate navigation:",e),o.call(window.location,e))},window.location.replace=function(e){return e.includes("ads")||e.includes("popup")||e.includes("redirect")||e.includes("promo")||e.includes("offer")||e.includes("casino")||e.includes("betting")||e.includes("dating")||e.includes("adult")||e.includes("doubleclick")||e.includes("googlesyndication")||e.includes("facebook.com/tr")||e.includes("googletagmanager")?(console.log("ðŸš« VidLink.pro - Blocked ad redirect:",e),!1):(console.log("âœ… VidLink.pro - Allowing legitimate navigation:",e),a.call(window.location,e))}}catch{console.log("ðŸš« VidLink.pro - Could not override location methods (read-only)")}window.addEventListener("beforeunload",o=>{o.preventDefault(),o.returnValue="",console.log("ðŸš« VidLink.pro - Blocked beforeunload redirect")});const p=o=>{const a=o.target;a&&(a.tagName==="A"||a.classList.contains("ad")||a.classList.contains("popup")||a.id.includes("ad")||a.className.includes("ad")||a.className.includes("vidlink"))&&(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),console.log("ðŸš« VidLink.pro - Blocked suspicious click"))};if(document.addEventListener("click",p,!0),n){const o=a=>{const e=a.target;e&&(e.classList.contains("ad")||e.classList.contains("popup")||e.classList.contains("banner")||e.classList.contains("advertisement")||e.id.includes("ad")||e.id.includes("popup")||e.tagName==="A"&&(e.getAttribute("href")?.includes("ads")||e.getAttribute("href")?.includes("popup")||e.getAttribute("href")?.includes("redirect")||e.getAttribute("href")?.includes("promo")||e.getAttribute("href")?.includes("casino")||e.getAttribute("href")?.includes("betting")))&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),console.log("ðŸ“± VidLink.pro - Blocked mobile ad touch"))};document.addEventListener("touchstart",o,{passive:!1,capture:!0}),document.addEventListener("touchend",o,{passive:!1,capture:!0}),console.log("ðŸ“± VidLink.pro - Mobile ad blocking enabled")}console.log("ðŸš« VidLink.pro - Smart ad blocking enabled");const f=window.fetch;return window.fetch=function(o,a){const e=typeof o=="string"?o:o.toString();return["googlesyndication.com","googleadservices.com","doubleclick.net","facebook.com/tr","google-analytics.com","googletagmanager.com","popads.net","popcash.net","propellerads.com","vidlink.pro/ads","vidlink.pro/analytics","vidlink.pro/tracking"].some(ae=>e.includes(ae))?(console.log("ðŸš« VidLink.pro - Blocked ad network request:",e),Promise.reject(new Error("Blocked by ad blocker"))):f.call(window,o,a)},()=>{window.open=i,window.alert=r,window.confirm=w,window.prompt=m,document.write=k,window.fetch=f,document.removeEventListener("click",p,!0),console.log("ðŸ§¹ VidLink.pro - Cleaned up ad blocking")}},[h]),l.useEffect(()=>{h&&(async()=>{if(d&&c)try{const{StreamingService:i}=await me(async()=>{const{StreamingService:w}=await import("./streamingService-jLzF5W_z.js");return{StreamingService:w}},__vite__mapDeps([0,1,2])),r=await i.findStreamingSources(d.id.toString(),c,y,j);r.length>0&&J(r)}catch(i){console.error("VidLink.pro - Failed to load additional sources:",i)}})()},[h,d,c,y,j]);const I=()=>{console.log(`VidLink.pro - Source ${v} failed, trying next source...`),v<A.length-1?(F(v+1),K(0),N(!1),console.log("VidLink.pro - Moving to next available source")):(N(!0),console.log("VidLink.pro - All sources failed"))},u=A[v]||x,B=()=>ee(u.url)[W]||u.url;l.useEffect(()=>{if(!h)M(!1),E(0),g.current&&(clearInterval(g.current),g.current=void 0),V.current&&(window.removeEventListener("message",V.current),V.current=null);else if(d&&c){const n=P.getWatchHistory().find(i=>i.id===d.id.toString()&&i.type===c);n&&s.current&&(s.current.currentTime=n.progress,E(n.progress))}},[h,d,c]),l.useEffect(()=>(d&&c&&h&&(x.type==="embed"?(P.updateWatchHistory(d,600,7200,c),g.current=window.setInterval(()=>{const r=600+Date.now()%3600;P.updateWatchHistory(d,r,7200,c)},3e4)):b&&L>0&&(g.current=window.setInterval(()=>{s.current&&L>0&&P.updateWatchHistory(d,s.current.currentTime,L,c)},1e4))),!b&&x.type!=="embed"&&g.current&&(clearInterval(g.current),g.current=void 0),()=>{g.current&&(clearInterval(g.current),g.current=void 0)}),[b,d,c,L,R,h,x.type]);const T=()=>{s.current&&(b?s.current.pause():s.current.play(),M(!b))},te=()=>{s.current&&(s.current.muted=!$,z(!$))},oe=n=>{const i=parseFloat(n.target.value);Y(i),s.current&&(s.current.volume=i,z(i===0))},ne=()=>{s.current&&E(s.current.currentTime)},ie=()=>{s.current&&Z(s.current.duration)},re=n=>{const i=parseFloat(n.target.value);E(i),s.current&&(s.current.currentTime=i)},q=n=>{const i=Math.floor(n/60),r=Math.floor(n%60);return`${i}:${r.toString().padStart(2,"0")}`},se=()=>{H(!0),U.current&&clearTimeout(U.current),U.current=window.setTimeout(()=>{b&&H(!1)},3e3)},le=()=>{s.current&&(document.fullscreenElement?document.exitFullscreen():s.current.requestFullscreen())};return h?t.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:t.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onMouseMove:se,children:[t.jsx("button",{onClick:G,className:"absolute top-4 right-4 z-10 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition-colors",children:t.jsx(ce,{className:"w-6 h-6"})}),A.length>1&&t.jsx("div",{className:"absolute top-16 right-4 z-20",children:t.jsx("select",{value:v,onChange:n=>{F(parseInt(n.target.value)),N(!1)},className:"bg-black/70 text-white px-3 py-1 rounded text-sm",children:A.map((n,i)=>t.jsxs("option",{value:i,children:[n.provider," (",n.quality,")"]},i))})}),t.jsx("div",{className:"absolute top-4 left-4 z-10 bg-black/70 text-white px-3 py-2 rounded text-sm",children:"ðŸŽ¬ Fast Stream Player"}),/iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50",children:t.jsxs("div",{className:"text-center text-white p-6",children:[t.jsx("h3",{className:"text-xl mb-4",children:"ðŸ“± Not Available on Mobile"}),t.jsx("p",{className:"mb-4",children:"Fast Stream is not compatible with mobile devices."}),t.jsx("p",{className:"text-sm opacity-75",children:"Please use a desktop browser or try Premium Stream."})]})}),D&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-30",children:t.jsxs("div",{className:"text-center text-white",children:[t.jsx("h3",{className:"text-xl mb-4",children:"Media Unavailable"}),t.jsx("p",{className:"mb-4",children:"Fast Stream failed to load this content."}),t.jsx("button",{onClick:()=>{F(0),N(!1)},className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded",children:"Retry"})]})}),!D&&u.type==="embed"?t.jsx("div",{className:"relative w-full h-full bg-black",children:t.jsx("iframe",{ref:C,src:B(),className:"w-full h-full border-0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",referrerPolicy:"unsafe-url",title:`${R} - VidLink.pro Player`,onLoad:()=>{const n=B();if(console.log("ðŸŽ¬ VidLink.pro iframe loaded:",u.provider,n),console.log("ðŸš« VidLink.pro - Enhanced popup blocking active"),console.log("ðŸ”— VidLink.pro - Using URL format:",n),N(!1),setTimeout(()=>{if(C.current)try{(C.current.contentDocument||C.current.contentWindow?.document)&&console.log("âœ… VidLink.pro - Direct URL format working properly")}catch{console.log("âœ… VidLink.pro - CORS protected (Direct URL format functional)")}},3e3),d&&c&&y&&j&&P.updateWatchHistory(d,0,3600,c,y,j,`S${y}E${j}`),c==="tv"&&S){V.current&&window.removeEventListener("message",V.current);const i=r=>{console.log("VidLink.pro - Received message from iframe:",r.data),r.data&&typeof r.data=="object"&&(r.data.type==="video-ended"||r.data.event==="ended"||r.data.action==="ended"||r.data.message==="video-ended")&&(console.log("VidLink.pro - Video ended message received, auto-advancing to next episode"),S()),typeof r.data=="string"&&(r.data==="video-ended"||r.data==="ended")&&(console.log("VidLink.pro - Video ended string message received, auto-advancing to next episode"),S())};V.current=i,window.addEventListener("message",i),console.log("VidLink.pro - Set up message listener for video end detection")}},onError:n=>{const i=B();console.error("ðŸš¨ VidLink.pro - Iframe failed to load:",u.provider,i,n),console.error("ðŸš¨ VidLink.pro - Error details:",n.type,n.target),/iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent)&&console.log("ðŸ“± VidLink.pro - Mobile iframe error detected"),console.log("ðŸ” VidLink.pro - Failed URL format:",i),console.log("ðŸ” VidLink.pro - Trying next alternative..."),I()}},`vidlink-${u.provider}-${v}-${W}`)}):D?null:t.jsx("video",{ref:s,src:u.url,className:"w-full h-full object-contain",onTimeUpdate:ne,onLoadedMetadata:ie,onPlay:()=>M(!0),onPause:()=>M(!1),onClick:T,onEnded:()=>{console.log("VidLink.pro - Video ended, checking for next episode"),c==="tv"&&S&&(console.log("VidLink.pro - Auto-advancing to next episode"),S())},onError:n=>{console.error("VidLink.pro - Video error:",n),console.error("VidLink.pro - Video src:",u.url),I()},onLoadStart:()=>console.log("VidLink.pro - Video load started:",u.url),onCanPlay:()=>console.log("VidLink.pro - Video can play:",u.url),onLoadedData:()=>console.log("VidLink.pro - Video data loaded:",u.url),crossOrigin:"anonymous",preload:"metadata"},`vidlink-video-${v}`),u.type!=="embed"&&t.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 transition-opacity duration-300 ${O?"opacity-100":"opacity-0"}`,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("input",{type:"range",min:"0",max:L||0,value:_,onChange:re,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer slider"}),t.jsxs("div",{className:"flex justify-between text-white text-sm mt-1",children:[t.jsx("span",{children:q(_)}),t.jsx("span",{children:q(L)})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:T,className:"p-2 text-white hover:text-gray-300 transition-colors",children:b?t.jsx(de,{className:"w-8 h-8"}):t.jsx(ue,{className:"w-8 h-8"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:te,className:"text-white hover:text-gray-300 transition-colors",children:$?t.jsx(ge,{className:"w-6 h-6"}):t.jsx(pe,{className:"w-6 h-6"})}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:$?0:Q,onChange:oe,className:"w-20 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer"})]}),t.jsxs("span",{className:"text-white font-medium",children:[R," - VidLink.pro"]})]}),t.jsx("div",{className:"flex items-center space-x-4",children:t.jsx("button",{onClick:le,className:"text-white hover:text-gray-300 transition-colors",children:t.jsx(fe,{className:"w-6 h-6"})})})]})]}),!u.url&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"text-white text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),t.jsx("p",{children:"Loading VidLink.pro player..."})]})})]})}):null};export{be as default};
