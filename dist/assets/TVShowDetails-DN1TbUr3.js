import{g as Q,d as X,r as o,j as e,L as _,h as E,i as W,F as Z,b as ee}from"./index-CZSZZV6j.js";import{t as se}from"./tmdb-eNF6KsIk.js";import{StreamingService as te}from"./streamingService-jLzF5W_z.js";import{W as g}from"./watchHistory-BPNt32Ju.js";import{W as T}from"./watchlist-BX-jt4tO.js";import{P as m}from"./providerStorage-CCn93MUr.js";import"./config-CeCXydgj.js";const de=()=>{const{id:n}=Q(),z=X(),[t,R]=o.useState(null),[C,v]=o.useState(null),[A,D]=o.useState(!1),[B,V]=o.useState([]),[r,b]=o.useState(1),[x,j]=o.useState(1),[N,w]=o.useState(!1),[l,H]=o.useState(m.getValidSelectedProvider()),[p,S]=o.useState(!1),k=o.useRef(null),I=typeof navigator<"u"&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),[u,M]=o.useState([]),[O,U]=o.useState([]);o.useEffect(()=>{if(console.log("Season changed to:",r),console.log("Episodes per season:",u),u[r]){const s=Array.from({length:u[r]},(a,i)=>i+1);console.log("Setting episodes for season",r,":",s),U(s),(x>u[r]||x===0)&&j(1)}},[r,u]),o.useEffect(()=>{n&&(q(n),w(T.isInWatchlist(n,"tv"))),window.scrollTo(0,0)},[n]),o.useEffect(()=>{const s=a=>{k.current&&!k.current.contains(a.target)&&S(!1)};if(p)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[p]);const q=async s=>{try{let a=function(){V([1]),M({1:10});const d=P();d?(b(d.season),j(d.episode)):b(1)};v(null);const i=await se.getDetails(s);if(R(i),console.log("TV Show Data:",i),i&&i.number_of_seasons&&i.number_of_seasons>0){const c=Array.from({length:i.number_of_seasons},(h,K)=>K+1);V(c);const d={};c.forEach(h=>{d[h]=10}),M(d);const f=P();f?(b(f.season),j(f.episode)):b(1)}else a()}catch(a){console.error("Error fetching TV show details:",a),v("Failed to load TV show details. Please try again.")}},Y=async()=>{if(!(!n||!t))try{D(!0),console.log(`ðŸŽ¬ TVShowDetails - Navigating to player for TV show ${n}, Season ${r}, Episode ${x}`),console.log("ðŸŽ¯ TVShowDetails - Selected provider:",l),console.log("ðŸ’¾ TVShowDetails - Saved provider from storage:",m.getValidSelectedProvider()),console.log("ðŸ” TVShowDetails - Provider being passed to StreamingService:",l);const s=await te.findStreamingSources(n,"tv",r,x,l);if(s&&s.length>0){const a=new URLSearchParams({type:"tv",title:t.name,season:r.toString(),episode:x.toString(),provider:l});z(`/player/${n}?${a.toString()}`),console.log(`Navigating to player with ${s.length} streaming sources using ${l}`),g.updateWatchHistory(t,60,3600,"tv",r,x,`S${r}E${x}`),window.dispatchEvent(new Event("refreshContinueWatching"))}else v("ðŸ“º No streaming sources available for the selected provider. Try a different provider.")}catch(s){console.error("Error loading stream:",s),v("Unable to load streaming sources. Please try again later.")}finally{D(!1)}},P=()=>{if(!n)return null;const a=g.getWatchHistory().filter(c=>c.id===n&&c.type==="tv");if(a.length===0)return null;const i=a.sort((c,d)=>new Date(d.lastWatched).getTime()-new Date(c.lastWatched).getTime())[0];return{season:i.season||1,episode:i.episode||1}},L=()=>n?g.getWatchProgress(n,"tv",r,x):null,y=()=>{const s=P();if(!s)return null;const a=g.getWatchProgress(n||"","tv",s.season,s.episode);return{season:s.season,episode:s.episode,isCompleted:a?.completed||!1,hasProgress:a&&!a.completed}},G=s=>{console.log("ðŸ”„ TVShowDetails - Changing provider from",l,"to",s),H(s),m.saveSelectedProvider(s),S(!1),console.log("âœ… TVShowDetails - Provider changed to:",s),console.log("ðŸ’¾ TVShowDetails - Saved to storage:",m.getValidSelectedProvider())},J=()=>{!t||!n||(N?T.removeFromWatchlist(n,"tv")&&(w(!1),console.log("Removed from watchlist:",t.name)):T.addToWatchlist(t,"tv")&&(w(!0),console.log("Added to watchlist:",t.name)))},$=s=>s?s.startsWith("http")?s:`https://image.tmdb.org/t/p/original${s}`:"/placeholder-poster.jpg",F=s=>s?new Date(s).getFullYear().toString():"Unknown";return C?e.jsx("div",{className:"min-h-screen bg-black py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(_,{to:"/",className:"inline-flex items-center text-white hover:text-gray-300 mb-6",children:[e.jsx(E,{className:"mr-2"}),"Back to Home"]}),e.jsx("div",{className:"bg-red-900 border-l-4 border-red-500 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-200",children:C})})]})})]})}):t?e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsxs("div",{className:"relative min-h-screen sm:min-h-[90vh] md:min-h-screen",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:$(t.backdrop_path||t.poster_path||""),alt:t.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/80 to-black/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/20"})]}),e.jsx("div",{className:"absolute top-4 sm:top-6 md:top-8 left-4 sm:left-6 md:left-8 z-20 safe-area-inset-top",children:e.jsxs(_,{to:"/",className:"inline-flex items-center text-white hover:text-gray-300 active:text-gray-400 transition-colors bg-black/50 backdrop-blur-sm px-3 sm:px-4 py-2 sm:py-2.5 rounded-full touch-manipulation min-h-[44px]",children:[e.jsx(E,{className:"mr-2 w-5 h-5"}),e.jsx("span",{className:"text-base font-medium",children:"Back"})]})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 md:px-8 py-8 pt-20 sm:pt-24 md:pt-28",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 md:gap-12",children:[e.jsx("div",{className:"flex-shrink-0 flex justify-center md:justify-start",children:e.jsx("img",{src:$(t.poster_path||""),alt:t.name,className:"w-56 h-80 sm:w-64 sm:h-96 md:w-72 md:h-[432px] object-cover rounded-lg shadow-2xl"})}),e.jsxs("div",{className:"flex-1 text-white text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 sm:mb-6 leading-tight",children:t.name}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 sm:gap-6 mb-6 text-base sm:text-lg",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-green-400 font-semibold",children:[Math.round(t.vote_average*10),"% Match"]})}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:F(t.first_air_date)})}),t.number_of_seasons&&e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{children:[t.number_of_seasons," Season",t.number_of_seasons!==1?"s":""]})})]}),t.genres&&t.genres.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-3 justify-center md:justify-start",children:t.genres.map(s=>e.jsx("span",{className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm sm:text-base font-medium",children:s.name},s.id))})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl sm:text-2xl md:text-3xl font-semibold mb-4 text-center md:text-left",children:"Overview"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl leading-relaxed text-gray-200 text-center md:text-left max-w-4xl",children:t.overview||"No overview available."})]}),e.jsxs("div",{className:"mb-4 mobile:mb-6",children:[e.jsxs("div",{className:"flex flex-col mobile:flex-row gap-3 mobile:gap-4 mb-3 mobile:mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("label",{className:"block text-xs mobile:text-sm font-medium text-gray-200 mb-2",children:["Season",(()=>{const s=y();return s&&s.season===r?e.jsx("span",{className:"ml-2 text-yellow-400 text-xs",children:"â€¢ You're here"}):null})()]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:r,onChange:s=>{const a=Number(s.target.value);console.log("Season dropdown changed to:",a),b(a)},className:"appearance-none w-full bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-3 mobile:px-4 py-2 mobile:py-3 pr-8 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm mobile:text-base min-h-[44px]",children:B.map(s=>{const a=y(),i=a&&a.season===s;return e.jsxs("option",{value:s,className:"bg-gray-800 text-white",children:["Season ",s,i?" â—":""]},s)})}),e.jsx(W,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white pointer-events-none w-4 h-4 mobile:w-5 mobile:h-5"})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("label",{className:"block text-xs mobile:text-sm font-medium text-gray-200 mb-2",children:["Episode",(()=>{const s=y();if(s&&s.season===r&&s.episode===x){if(s.hasProgress)return e.jsx("span",{className:"ml-2 text-yellow-400 text-xs",children:"â€¢ In Progress"});if(s.isCompleted)return e.jsx("span",{className:"ml-2 text-green-400 text-xs",children:"â€¢ You're here"})}return null})()]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:x,onChange:s=>j(Number(s.target.value)),className:"appearance-none w-full bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg px-3 mobile:px-4 py-2 mobile:py-3 pr-8 text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm mobile:text-base min-h-[44px]",children:O.map(s=>{const a=g.getWatchProgress(n||"","tv",r,s),i=a&&a.completed,c=a&&!a.completed,d=y(),f=d&&d.season===r&&d.episode===s;let h="";return f?h=" â—":h=i?" âœ“":c?" â–¶":"",e.jsxs("option",{value:s,className:"bg-gray-800 text-white",children:["Episode ",s,h]},s)})}),e.jsx(W,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-white pointer-events-none w-4 h-4 mobile:w-5 mobile:h-5"})]})]})]}),(()=>{const s=L();return s&&s.completed?e.jsx("div",{className:"text-green-400 text-xs mobile:text-sm mb-3 mobile:mb-4 text-center lg:text-left",children:"âœ“ Episode completed"}):s&&!s.completed?e.jsxs("div",{className:"text-yellow-400 text-xs mobile:text-sm mb-3 mobile:mb-4 text-center lg:text-left",children:["â–¶ ",g.formatProgress(s.progress,s.duration)," watched"]}):null})()]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center md:justify-start",children:[(()=>{const s=L(),a=s&&s.completed,i=s&&!s.completed;let c="Play",d="flex items-center justify-center px-8 sm:px-10 py-3 sm:py-4 bg-white text-black hover:bg-gray-200 active:bg-gray-300 disabled:bg-gray-400 disabled:text-gray-600 font-bold rounded-lg transition-all duration-200 transform active:scale-95 min-h-[48px] sm:min-h-[52px] shadow-lg touch-manipulation";return a?c="Watch Again":i&&(c="Continue Watching"),e.jsxs("button",{onClick:Y,disabled:A,className:d,children:[e.jsx(Z,{className:"mr-3 w-5 h-5 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-base sm:text-lg font-semibold",children:A?"Loading...":c})]})})(),e.jsxs("button",{onClick:J,className:`flex items-center justify-center px-8 sm:px-10 py-3 sm:py-4 font-bold rounded-lg transition-all duration-200 transform active:scale-95 min-h-[48px] sm:min-h-[52px] backdrop-blur-sm touch-manipulation ${N?"bg-[#e50914] hover:bg-[#b8070f] active:bg-[#a00610] text-white shadow-lg":"bg-gray-600/70 hover:bg-gray-500/80 active:bg-[#e50914] text-white"}`,children:[!N&&e.jsx(ee,{className:"mr-3 w-5 h-5 sm:w-6 sm:h-6"}),e.jsx("span",{className:"text-base sm:text-lg font-semibold",children:N?"In My List âœ“":"Add to My List"})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-4 text-center md:text-left text-white",children:"Select Streaming Provider"}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),S(!p)},className:"w-full sm:w-auto flex items-center justify-between px-6 py-3 bg-gray-800/80 hover:bg-gray-700/80 active:bg-gray-600/80 text-white rounded-lg backdrop-blur-sm border border-gray-600/50 transition-all duration-200 min-h-[48px] touch-manipulation",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${l==="vidking"?"bg-red-500":l==="vidsrccc"?"bg-blue-500":l==="vidsrcxyz"?"bg-cyan-500":l==="vidlink"?"bg-green-500":l==="vidsrcicu"?"bg-purple-500":l==="vidsrcto"?"bg-orange-500":l==="autoembed"?"bg-yellow-500":l==="2embed"?"bg-pink-500":"bg-gray-500"}`}),e.jsxs("span",{className:"text-base font-medium",children:[m.getAvailableProviders().find(s=>s.id===l)?.name||"Premium Stream"," (",m.getAvailableProviders().find(s=>s.id===l)?.quality||"1080p",")"]})]}),e.jsx(W,{className:`w-5 h-5 transition-transform duration-200 ${p?"rotate-180":""}`})]}),p&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gray-800/95 backdrop-blur-sm border border-gray-600/50 rounded-lg shadow-2xl z-50 overflow-hidden",children:(I?m.getMobileProviders():m.getAvailableProviders()).map(s=>e.jsxs("button",{onClick:a=>{a.stopPropagation(),G(s.id)},className:`w-full flex items-center px-6 py-4 text-left hover:bg-gray-700/80 active:bg-gray-600/80 transition-colors duration-200 touch-manipulation ${l===s.id?"bg-gray-700/60":""}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${s.id==="vidking"?"bg-red-500":s.id==="vidsrccc"?"bg-blue-500":s.id==="vidsrcxyz"?"bg-cyan-500":s.id==="vidlink"?"bg-green-500":s.id==="vidsrcicu"?"bg-purple-500":s.id==="vidsrcto"?"bg-orange-500":s.id==="autoembed"?"bg-yellow-500":s.id==="2embed"?"bg-pink-500":"bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-base",children:s.name}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[s.quality," â€¢ ",s.adBlockFriendly?"Ad-block friendly":"May have ads"]})]}),l===s.id&&e.jsx("div",{className:"ml-auto w-2 h-2 bg-red-500 rounded-full"})]},s.id))})]}),e.jsx("div",{className:"mt-4 p-4 bg-gray-800/40 rounded-lg backdrop-blur-sm border border-gray-600/30",children:e.jsxs("p",{className:"text-gray-300 text-sm text-center md:text-left",children:[e.jsx("span",{className:"font-medium",children:"Selected:"})," ",m.getAvailableProviders().find(s=>s.id===l)?.name,e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx("span",{className:"text-green-400",children:m.getAvailableProviders().find(s=>s.id===l)?.quality}),m.getAvailableProviders().find(s=>s.id===l)?.adBlockFriendly&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx("span",{className:"text-blue-400",children:"Ad-block friendly"})]})]})})]})]})]})})]}),e.jsx("div",{className:"px-3 mobile:px-4 md:px-8 lg:px-16 py-8 mobile:py-12",children:e.jsxs("div",{className:"max-w-4xl",children:[t.genres&&t.genres.length>0&&e.jsx("div",{className:"mb-6 mobile:mb-8",children:e.jsx("div",{className:"flex flex-wrap gap-2 justify-center md:justify-start",children:t.genres.map(s=>e.jsx("span",{className:"text-white text-xs mobile:text-sm px-2 mobile:px-3 py-1 border border-gray-600 rounded-full",children:s.name},s.id))})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mobile:gap-8",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("h2",{className:"text-white text-xl mobile:text-2xl font-semibold mb-3 mobile:mb-4 text-center md:text-left",children:["About ",t.name]}),e.jsx("div",{className:"text-gray-300 space-y-3 mobile:space-y-4",children:e.jsx("p",{className:"text-sm mobile:text-base leading-relaxed text-center md:text-left",children:t.overview||"No overview available."})})]}),e.jsxs("div",{className:"space-y-3 mobile:space-y-4",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-gray-400 text-xs mobile:text-sm",children:"First air date: "}),e.jsx("span",{className:"text-white text-sm mobile:text-base",children:F(t.first_air_date)})]}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-gray-400 text-xs mobile:text-sm",children:"Rating: "}),e.jsxs("span",{className:"text-white text-sm mobile:text-base",children:[t.vote_average.toFixed(1),"/10"]})]}),t.number_of_seasons&&e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-gray-400 text-xs mobile:text-sm",children:"Seasons: "}),e.jsx("span",{className:"text-white text-sm mobile:text-base",children:t.number_of_seasons})]}),t.number_of_episodes&&e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-gray-400 text-xs mobile:text-sm",children:"Episodes: "}),e.jsx("span",{className:"text-white text-sm mobile:text-base",children:t.number_of_episodes})]}),t.production_companies&&t.production_companies.length>0&&e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-gray-400 text-xs mobile:text-sm",children:"Production: "}),e.jsx("span",{className:"text-white text-sm mobile:text-base",children:t.production_companies.slice(0,2).map(s=>s.name).join(", ")})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-black",children:e.jsxs("div",{className:"relative min-h-screen sm:min-h-[90vh] md:min-h-screen",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-800 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black via-black/80 to-black/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/20"}),e.jsx("div",{className:"absolute top-4 sm:top-6 md:top-8 left-4 sm:left-6 md:left-8 z-20",children:e.jsxs(_,{to:"/",className:"inline-flex items-center text-white hover:text-gray-300 active:text-gray-400 transition-colors bg-black/50 backdrop-blur-sm px-3 sm:px-4 py-2 sm:py-2.5 rounded-full touch-manipulation min-h-[44px]",children:[e.jsx(E,{className:"mr-2 w-5 h-5"}),e.jsx("span",{className:"text-base font-medium",children:"Back"})]})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 md:px-8 py-8 pt-20 sm:pt-24 md:pt-28",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 md:gap-12",children:[e.jsx("div",{className:"flex-shrink-0 flex justify-center md:justify-start",children:e.jsx("div",{className:"w-56 h-80 sm:w-64 sm:h-96 md:w-72 md:h-[432px] bg-gray-700 animate-pulse rounded-lg"})}),e.jsxs("div",{className:"flex-1 text-white text-center md:text-left",children:[e.jsx("div",{className:"h-12 sm:h-16 md:h-20 bg-gray-700 animate-pulse rounded mb-6 max-w-2xl mx-auto md:mx-0"}),e.jsx("div",{className:"h-6 bg-gray-700 animate-pulse rounded mb-6 max-w-md mx-auto md:mx-0"}),e.jsx("div",{className:"h-4 bg-gray-700 animate-pulse rounded mb-2 max-w-xl mx-auto md:mx-0"}),e.jsx("div",{className:"h-4 bg-gray-700 animate-pulse rounded mb-6 max-w-lg mx-auto md:mx-0"}),e.jsxs("div",{className:"flex flex-col mobile:flex-row gap-3 mobile:gap-4 mb-6",children:[e.jsx("div",{className:"h-16 bg-gray-700 animate-pulse rounded-lg flex-1"}),e.jsx("div",{className:"h-16 bg-gray-700 animate-pulse rounded-lg flex-1"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center md:justify-start",children:[e.jsx("div",{className:"h-12 sm:h-14 w-32 bg-gray-700 animate-pulse rounded-lg"}),e.jsx("div",{className:"h-12 sm:h-14 w-40 bg-gray-700 animate-pulse rounded-lg"})]})]})]})})]})})};export{de as default};
