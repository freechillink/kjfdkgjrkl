import{r as n,u as k,z as B,j as o,h as P}from"./index-CZSZZV6j.js";import{W as T}from"./watchHistory-BPNt32Ju.js";const L=({source:t,onClose:b,isOpen:r,mediaItem:u,mediaType:g,season:h,episode:x})=>{if(!t||!r)return null;const[j,a]=n.useState(!0),l=n.useRef(void 0),p=n.useRef(null),{deviceInfo:s,isMobile:N}=k(),f=s.os==="ios"&&N,m=()=>{a(!0),l.current&&clearTimeout(l.current),l.current=window.setTimeout(()=>{a(!1)},3e3)};return n.useEffect(()=>{if(!r||t.type!=="embed")return;console.log(`🎬 Loading ${t.provider} with comprehensive ad/popup blocking`);const c=window.open,v=document.write,w=document.writeln;window.open=function(e,d){return console.log("🚫 Blocked popup attempt to:",e,"target:",d),null};try{Object.defineProperty(window.location,"assign",{value:function(e){console.log("🚫 Blocked location.assign redirect to:",e)},writable:!1})}catch{console.log("⚠️ Could not override location.assign (read-only property)")}try{Object.defineProperty(window.location,"replace",{value:function(e){console.log("🚫 Blocked location.replace redirect to:",e)},writable:!1})}catch{console.log("⚠️ Could not override location.replace (read-only property)")}document.write=function(e){if(e.includes("ad")||e.includes("popup")||e.includes("redirect")||e.includes("banner")||e.includes("sponsor")){console.log("🚫 Blocked document.write with ad content");return}return v.call(document,e)},document.writeln=function(e){if(e.includes("ad")||e.includes("popup")||e.includes("redirect")){console.log("🚫 Blocked document.writeln with ad content");return}return w.call(document,e)};const y=e=>(e.preventDefault(),e.returnValue="",console.log("🚫 Blocked navigation attempt"),""),E=setInterval(()=>{['[id*="ad"]','[class*="ad"]','[id*="popup"]','[class*="popup"]','[id*="banner"]','[class*="banner"]','[id*="sponsor"]','[class*="sponsor"]',".advertisement",".popup",".banner",".sponsor",".ad-container",'iframe[src*="ads"]','iframe[src*="popup"]','iframe[src*="banner"]'].forEach(d=>{document.querySelectorAll(d).forEach(i=>{i instanceof HTMLElement&&i!==p.current&&(i.style.display="none !important",i.style.visibility="hidden !important",i.style.opacity="0 !important")})})},500);return window.addEventListener("beforeunload",y),()=>{window.removeEventListener("beforeunload",y),clearInterval(E),window.open=c,document.write=v,document.writeln=w,console.log("🔄 Restored original window functions for VidSrc.xyz")}},[r,t.type,t.provider]),n.useEffect(()=>{if(r){const c=setTimeout(()=>{a(!1)},3e3);return()=>clearTimeout(c)}},[r]),n.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),B.createPortal(o.jsx("div",{className:"fixed inset-0 z-[9999] bg-black",children:o.jsx("div",{className:"relative w-full h-full flex flex-col",onMouseMove:m,onTouchStart:m,children:o.jsxs("div",{className:"flex-1 relative",style:{backgroundColor:"#000",overflow:"hidden"},children:[o.jsx("iframe",{ref:p,src:t.url,className:"w-full h-full border-0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",referrerPolicy:"no-referrer",loading:"eager",title:`${t.provider} Player`,webkitallowfullscreen:"true",mozallowfullscreen:"true",autoPlay:f?"true":void 0,playsInline:f?"true":void 0,style:{border:"none",outline:"none",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1,position:"relative"},onLoad:()=>{console.log(`🎬 ${t.provider} player loaded (NO SANDBOX - POPUP BLOCKING ACTIVE)`),u&&T.updateWatchHistory(u,60,7200,g||"movie",h,x)}}),o.jsxs("div",{className:`absolute inset-0 transition-opacity duration-300 ${j?"opacity-100":"opacity-0"}`,style:{pointerEvents:"none",zIndex:10},children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-20 bg-gradient-to-b from-black/50 to-transparent"}),o.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between",style:{paddingTop:s.os==="ios"?"calc(1rem + env(safe-area-inset-top))":"1rem",paddingLeft:s.os==="ios"?"calc(1rem + env(safe-area-inset-left))":"1rem",paddingRight:s.os==="ios"?"calc(1rem + env(safe-area-inset-right))":"1rem"},children:[o.jsxs("button",{onClick:b,className:"flex items-center space-x-2 px-4 py-2 bg-black/70 hover:bg-black/90 rounded-lg transition-colors backdrop-blur-sm z-50 touch:active:scale-95",style:{pointerEvents:"auto"},children:[o.jsx(P,{className:"w-5 h-5"}),o.jsx("span",{className:"text-sm",children:"Back"})]}),o.jsx("div",{className:"flex items-center space-x-2",style:{pointerEvents:"none"},children:o.jsxs("span",{className:"text-sm bg-black/50 px-2 py-1 rounded backdrop-blur-sm",children:[t.provider," • ",t.quality," • No Sandbox"]})})]})]})]})})}),document.body)};export{L as default};
